name: Twingate Connector Setup

on:
  workflow_dispatch:

jobs:
  twingate-connector:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Install Twingate Connector CLI
        run: |
          echo "ðŸ”§ Twingate CLI kuruluyor..."
          curl -fsSL https://binaries.twingate.com/connector/setup.sh -o setup.sh
          chmod +x setup.sh
          sudo ./setup.sh
          echo "âœ… Twingate CLI kuruldu"

      - name: Authenticate Connector with Tokens
        run: |
          echo "ðŸ” Connector baÄŸlanÄ±yor..."
          sudo /opt/twingate/setup \
            --access-token "${{ secrets.TWINGATE_ACCESS_TOKEN }}" \
            --refresh-token "${{ secrets.TWINGATE_REFRESH_TOKEN }}"
          sleep 15
          echo "âœ… Connector aÄŸa baÄŸlandÄ±"

      - name: Show Connector IP
        run: |
          IP=$(hostname -I | awk '{print $1}')
          echo "Connector IP: $IP"
          echo "TWINGATE_IP=$IP" >> $GITHUB_ENV

      - name: Keep Connector Alive
        run: |
          echo ""
          echo "=== TWINGATE CONNECTOR ACTIVE ==="
          echo "IP: $TWINGATE_IP"
          while true; do
            echo "[ $(date) ] Connector Ã§alÄ±ÅŸÄ±yor..."
            sleep 300
          done
